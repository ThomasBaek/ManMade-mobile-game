<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MadeMan.IdleEmpire.ViewModels"
             x:Class="MadeMan.IdleEmpire.Views.Components.SkillsPanel"
             x:DataType="vm:MainViewModel">

    <Frame BackgroundColor="{StaticResource Surface}"
           CornerRadius="12"
           Padding="12"
           Margin="0,8"
           BorderColor="Transparent">

        <VerticalStackLayout Spacing="8">

            <!-- Header -->
            <Grid ColumnDefinitions="*,Auto">
                <Label Text="SKILLS"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{StaticResource TextSecondary}"/>
                <Label Grid.Column="1"
                       Text="{Binding SkillVM.NextMilestoneText}"
                       FontSize="12"
                       TextColor="{StaticResource TextSecondary}"/>
            </Grid>

            <!-- Progress Bar -->
            <Grid HeightRequest="8">
                <Frame BackgroundColor="{StaticResource Background}"
                       CornerRadius="4"
                       Padding="0"
                       BorderColor="Transparent"/>
                <BoxView BackgroundColor="{StaticResource Gold}"
                         CornerRadius="4"
                         HorizontalOptions="Start"
                         WidthRequest="{Binding SkillVM.MilestoneProgress, Converter={StaticResource ProgressToWidth}}"/>
            </Grid>

            <!-- Active Skills -->
            <FlexLayout Direction="Row"
                        Wrap="Wrap"
                        JustifyContent="Start"
                        AlignItems="Start"
                        BindableLayout.ItemsSource="{Binding SkillVM.ActiveSkills}">
                <BindableLayout.ItemTemplate>
                    <DataTemplate x:DataType="vm:SkillDisplayModel">
                        <Frame Margin="4"
                               Padding="8"
                               BackgroundColor="{StaticResource Background}"
                               CornerRadius="8"
                               WidthRequest="90"
                               HeightRequest="80"
                               BorderColor="Transparent">
                            <VerticalStackLayout Spacing="2" VerticalOptions="Center">

                                <!-- Icon -->
                                <Label Text="{Binding Icon}"
                                       FontSize="24"
                                       HorizontalOptions="Center"/>

                                <!-- Name -->
                                <Label Text="{Binding Name}"
                                       FontSize="9"
                                       FontAttributes="Bold"
                                       HorizontalTextAlignment="Center"
                                       TextColor="{StaticResource TextPrimary}"
                                       LineBreakMode="TailTruncation"
                                       MaxLines="1"/>

                                <!-- Level -->
                                <Label Text="{Binding LevelDisplay}"
                                       FontSize="10"
                                       HorizontalTextAlignment="Center"
                                       TextColor="{StaticResource Gold}"/>

                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </FlexLayout>

            <!-- Empty State -->
            <Label Text="No skills yet. Earn more to unlock!"
                   FontSize="12"
                   TextColor="{StaticResource TextSecondary}"
                   HorizontalOptions="Center"
                   IsVisible="{Binding SkillVM.ActiveSkillCount, Converter={StaticResource ZeroToBool}}"/>

        </VerticalStackLayout>
    </Frame>
</ContentView>
